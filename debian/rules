#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all

BUILD_DIR = obj-$(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

%:
	dh $@ --builddirectory=$(BUILD_DIR)

override_dh_auto_clean:
	dh_auto_clean --builddirectory=$(BUILD_DIR)
	rm -rf $(BUILD_DIR)

override_dh_auto_configure:
	cmake -S . -B $(BUILD_DIR) \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_VERBOSE_MAKEFILE=ON \
		-DABIVERSION=$(shell dpkg-parsechangelog | sed -rne 's/^Version: 0\.0\.([0-9]+).*$$/\1/p') \
		-DBUILD_LUA=OFF \
		-DBUILD_EXAMPLES=OFF

override_dh_installsystemd:
	dh_installsystemd --name=ubusd
